/* =========================
   GLOBAL SITE SCRIPT
   KURNALPI ORGANICS
   ========================= */

document.addEventListener("DOMContentLoaded", () => {
    setupHamburgerMenu();
    updateCartTotal();
});

/* =========================
   HAMBURGER MENU
   ========================= */
function setupHamburgerMenu() {
    const hamburger = document.getElementById("hamburger");
    const navMenu = document.getElementById("nav-menu");

    if (!hamburger || !navMenu) return;

    hamburger.addEventListener("click", () => {
        navMenu.classList.toggle("active");
    });
}

/* =========================
   CART STORAGE HELPERS
   ========================= */
function getCart() {
    return JSON.parse(localStorage.getItem("cart")) || [];
}

function saveCart(cart) {
    localStorage.setItem("cart", JSON.stringify(cart));
}

/* =========================
   ADD TO CART
   ========================= */
function addToCart(name, price, quantity, image) {
    const cart = getCart();

    const existingItem = cart.find(item => item.name === name);

    if (existingItem) {
        existingItem.quantity += quantity;
    } else {
        cart.push({
            name,
            price,
            quantity,
            image
        });
    }

    saveCart(cart);
    updateCartTotal();

    alert(`${name} added to cart`);
}

/* =========================
   UPDATE CART TOTAL
   ========================= */
function updateCartTotal() {
    const cartTotalEl = document.getElementById("cart-total");
    if (!cartTotalEl) return;

    const cart = getCart();
    let total = 0;

    cart.forEach(item => {
        total += item.price * item.quantity;
    });

    cartTotalEl.textContent = "R" + total.toFixed(2);
}

/* =========================
   RENDER CART PAGE ITEMS
   ========================= */
function renderCart() {
    const cartContainer = document.getElementById("cart-items");
    const cartTotalEl = document.getElementById("cart-total");

    if (!cartContainer) return;

    const cart = getCart();
    cartContainer.innerHTML = "";

    let total = 0;

    if (cart.length === 0) {
        cartContainer.innerHTML = "<p>Your cart is empty.</p>";
        if (cartTotalEl) cartTotalEl.textContent = "R0.00";
        return;
    }

    cart.forEach((item, index) => {
        total += item.price * item.quantity;

        const itemDiv = document.createElement("div");
        itemDiv.className = "cart-item";

        itemDiv.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <div class="cart-info">
                <h3>${item.name}</h3>
                <p>Price: R${item.price}</p>
                <p>Quantity: ${item.quantity}</p>
                <p><strong>Subtotal: R${(item.price * item.quantity).toFixed(2)}</strong></p>
                <button onclick="removeFromCart(${index})">Remove</button>
            </div>
        `;

        cartContainer.appendChild(itemDiv);
    });

    if (cartTotalEl) {
        cartTotalEl.textContent = "R" + total.toFixed(2);
    }
}

/* =========================
   REMOVE ITEM FROM CART
   ========================= */
function removeFromCart(index) {
    const cart = getCart();
    cart.splice(index, 1);
    saveCart(cart);
    renderCart();
    updateCartTotal();
}

/* =========================
   CLEAR CART (OPTIONAL)
   ========================= */
function clearCart() {
    localStorage.removeItem("cart");
    updateCartTotal();
    renderCart();
}
